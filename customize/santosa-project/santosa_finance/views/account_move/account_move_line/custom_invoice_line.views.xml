<?xml version="1.0" encoding="UTF-8"?>
<odoo>
    <!-- Inherit form view dari account.move -->
    <record id="view_move_line_form_custom" model="ir.ui.view">
        <field name="name">account.move.form.custom</field>
        <field name="model">account.move</field>
        <field name="inherit_id" ref="account.view_move_form"/>
        <field name="arch" type="xml">            
            <xpath expr="//field[@name='invoice_line_ids']/tree" position="inside">
                <field name="costprice_jasamedik" optional='show'/>
                <field name="transaction_date" optional="hide"/>
                <field name="transaction_class" optional="hide"/>
                <field name="document_trx_date" optional="hide"/>
                <field name="med_rec_number" optional="hide"/>
                <field name="group" optional="hide"/>
                <field name="no_invoice_farmasi" optional="hide"/>
                <field name="dokter_code" optional="hide"/>
                <field name="dokter_name" optional="hide"/>
                <field name="unit_code" optional="hide"/>
                <field name="unit_name" optional="hide"/>
                <field name="no_sep_ref_no" optional="hide"/>
                <field name="registration_no" optional="hide"/>
                <field name="invoice_amount" optional="hide"/>
                <!-- <field name="discount" optional="hide"/> -->
                <field name="nomor_invoice" optional="hide"/>
                <field name="no_trx" optional="hide"/>
                <field name="need_to_calculate" optional="hide"/>
                <field name="idTrx" optional="hide"/>
                <field name="cost_price" optional="hide"/>
                <field name="cost_price_avg" optional="hide"/>
                <field name="cost_price_last_date" optional="hide"/>
                <field name="cost_price_last_based" optional="hide"/>
                <!-- <field name="pelayanan" widget="badge" decoration-success="pelayanan == 'non pelayanan'" decoration-danger="pelayanan == 'pelayanan'" on_change="1" field_id="pelayanan_0"/> -->
                <field name="is_klaim" column_invisible="1"/>

            </xpath>
            <xpath expr="//field[@name='invoice_line_ids']/tree/field[@name='discount']" position="replace">
                <field name="discount_subtotal" optional="hide" string="Discount Subtotal"/>
            </xpath>
            <xpath expr="//page[@name='invoice_tab']" position="attributes">
                <attribute name="invisible">is_klaim or pelayanan != 'pelayanan'</attribute>
            </xpath>
            
            <!-- <xpath expr="//field[@name='line_ids']/tree/field[@name='account_id']" position="replace">
                <field name="account_id" optional="show"/>
            </xpath>
            <xpath expr="//field[@name='line_ids']/tree/field[@name='debit']" position="replace">
                <field name="debit" optional="show"/>
            </xpath>
            <xpath expr="//field[@name='line_ids']/tree/field[@name='credit']" position="replace">
                <field name="credit" optional="show"/>
            </xpath> -->
            <xpath expr="//field[@name='invoice_line_ids']/tree/field[@name='product_id']" position="before">
                <field name="create_date" optional="show" string="Create Date"/>
                <field name="populate_date" optional="hide"/>
                <field name="entered_date" optional="show"/>
            </xpath>
            <xpath expr="//field[@name='line_ids']/tree/field[@name='account_id']" position="before">
                <field name="create_date" optional="show" string="Create Date"/>
                <field name="populate_date" column_invisible="1"/>
                <field name="entered_date" optional="hide"/>
                <field name="idTrx" optional='show'/>
                <field name="flag" optional='show'/>
                <field name="no_trx" optional='hide'/>
                <field name="cost_price" optional="show"/>
                <field name="cost_price_avg" optional="show"/>
                <field name="dokter_name" optional="hide"/>
                <field name="costprice_jasamedik" column_invisible="1"/>
                <field name="quantity" optional='hide'/>
                <field name="is_klaim" column_invisible="1"/>
            </xpath>
            <xpath expr="//field[@name='line_ids']/tree" position="attributes">
                <attribute name="default_order">entered_date,account_id asc</attribute>
            </xpath>
            <xpath expr="//field[@name='line_ids']/tree/field[@name='tax_tag_ids']" position="after">
                <field name="accounting_periode_id" optional='show'/>
            </xpath>
            <!-- <xpath expr="//field[@name='line_ids']" position="attributes">
                <attribute name="invisible">[('amount_total_signed', '=', 0)]</attribute>
            </xpath> -->
            <xpath expr="//page[@name='invoice_tab']" position="after">
                <page id="invoice_tab" name="invoice_non_pelayanan_tab" string="Invoice Lines" invisible="is_klaim or pelayanan == 'pelayanan'">
                    <field name="invoice_line_ids" widget="section_and_note_one2many" mode="tree,kanban" context="{'default_move_type': context.get('default_move_type'),'journal_id': journal_id, 'default_currency_id': currency_id or company_currency_id, 'default_display_type': 'product', 'quick_encoding_vals': quick_encoding_vals,}" readonly="state != 'draft'" on_change="1" field_id="invoice_line_ids_1"> 
                        <tree editable="bottom" string="Journal Items" default_order="sequence, id" create="true" group_by="entered_date" class="o_horizontal_scroll"><field name="sequence" widget="handle"/>
                            <field name="create_date" optional="show" string="Create Date"/>
                            <field name="populate_date" column_invisible="1"/>
                            <field name="entered_date" optional="hide"/>
                            <field name="product_id" string="Product" optional="show"/>
                            <field name="name" widget="section_and_note_text" optional="show"/>
                            <field string="Asset Category" column_invisible="parent.move_type != 'in_invoice'" name="asset_category_id" domain="[('type','=','purchase')]" context="{'default_type':'purchase'}" can_create="True" can_write="True"/>
                            <field name="account_id" context="{'partner_id': partner_id, 'move_type': parent.move_type}" options="{'no_quick_create': True}" domain="[('deprecated', '=', False), ('account_type', 'not in', ('asset_receivable', 'liability_payable', 'off_balance')), ('company_id', 'parent_of', parent.company_id)]" required="display_type not in ('line_note', 'line_section')" on_change="1" can_create="True" can_write="True"/>
                            <field name="quantity" optional="show" on_change="1"/>
                            <field name="product_uom_category_id" column_invisible="True"/>
                            <field name="product_uom_id" string="UoM" optional="show" on_change="1" can_create="True" can_write="True"/>
                            <field name="product_uom_id" column_invisible="True" on_change="1" can_create="True" can_write="True"/>
                            <field name="price_unit" string="Price" on_change="1"/>
                            <field name="discount_subtotal" optional="hide" string="Discount Subtotal"/>
                            <field name="tax_ids" widget="many2many_tags" domain="[('type_tax_use', '=?', parent.invoice_filter_type_domain), ('company_id', 'parent_of', parent.company_id), ('country_id', '=', parent.tax_country_id)]" context="{'append_type_to_tax_name': not parent.invoice_filter_type_domain, 'active_test': True}" options="{'no_create': True}" optional="show" on_change="1" can_create="True" can_write="True"/>
                            <field name="price_subtotal" string="Tax excl." on_change="1"/>
                            <field name="price_total" string="Tax incl." column_invisible="parent.tax_calculation_rounding_method == 'round_globally'" optional="hide" on_change="1"/>
                            <field name="partner_id" column_invisible="True" on_change="1" can_create="True" can_write="True"/>
                            <field name="currency_id" column_invisible="True" on_change="1" can_create="True" can_write="True"/>
                            <field name="company_id" column_invisible="True" on_change="1"/>
                            <field name="purchase_line_id" column_invisible="True" on_change="1" can_create="True" can_write="True"/>
                            <field name="purchase_order_id" column_invisible="parent.move_type != 'in_invoice'" optional="hide"/>
                            <field name="company_currency_id" column_invisible="True"/>
                            <field name="display_type" force_save="1" column_invisible="True" on_change="1"/>
                            <field name="transaction_date" optional="hide"/>
                            <field name="transaction_class" optional="hide"/>
                            <field name="document_trx_date" optional="hide"/>
                            <field name="med_rec_number" optional="hide"/>
                            <field name="group" optional="hide"/>
                            <field name="no_invoice_farmasi" optional="hide"/>
                            <field name="dokter_code" optional="hide"/>
                            <field name="dokter_name" optional="hide"/>
                            <field name="unit_code" optional="hide"/>ccount" readonly="1"
                            <field name="unit_name" optional="hide"/>
                            <field name="no_sep_ref_no" optional="hide"/>
                            <field name="registration_no" optional="hide"/>
                            <field name="invoice_amount" optional="hide" on_change="1"/>
                            <field name="nomor_invoice" optional="hide"/>
                            <field name="no_trx" optional="hide"/>
                            <field name="need_to_calculate" optional="hide"/>
                            <field name="idTrx" optional="hide"/>
                            <field name="cost_price" optional="hide"/>
                            <field name="cost_price_avg" optional="hide"/>
                            <field name="cost_price_last_date" optional="hide"/>
                            <field name="cost_price_last_based" optional="hide"/>
                            <field name="is_klaim" column_invisible="1"/>
                        </tree>
                    </field>
                    <group col="12" class="oe_invoice_lines_tab">
                        <group colspan="8">
                            <field name="narration" placeholder="Terms and Conditions" colspan="2" nolabel="1" field_id="narration_0"/>
                        </group>
                        <group colspan="4">
                            <group class="oe_subtotal_footer" invisible="move_type not in ('out_invoice', 'out_refund', 'in_invoice', 'in_refund', 'out_receipt', 'in_receipt') or payment_state == 'invoicing_legacy'">
                                <field name="tax_totals" widget="account-tax-totals-field" nolabel="1" colspan="2" readonly="state != 'draft' or (move_type not in ('in_invoice', 'in_refund', 'in_receipt') and not quick_edit_mode)" on_change="1" field_id="tax_totals_0"/>
                                <field name="invoice_payments_widget" colspan="2" nolabel="1" widget="payment" field_id="invoice_payments_widget_0"/>
                                <field name="amount_residual" class="oe_subtotal_footer_separator" invisible="state == 'draft'" on_change="1" field_id="amount_residual_0"/>
                            </group>
                            <field name="invoice_outstanding_credits_debits_widget" class="oe_invoice_outstanding_credits_debits" colspan="2" nolabel="1" widget="payment" invisible="state != 'posted'" field_id="invoice_outstanding_credits_debits_widget_0"/>
                        </group>
                    </group>
                </page>
                <page id="klaim_invoice_tab" name="klaim_tab" string="Detail Klaim" invisible="not is_klaim">
                    <field name="invoice_line_ids" context="{'default_move_type': context.get('default_move_type'),'journal_id': journal_id, 'default_currency_id': currency_id or company_currency_id, 'default_display_type': 'product', 'quick_encoding_vals': quick_encoding_vals,}" readonly="state != 'draft'" on_change="1" field_id="invoice_line_ids_2"> 
                        <tree editable="bottom" create="1" string="Detail Klaim" group_by="entered_date" default_order="sequence, id" class="o_horizontal_scroll">
                            <field name="create_date" optional="show" string="Create Date"/>
                            <field name="company_id" column_invisible="1"/>
                            <field name="currency_id" column_invisible="1"/>
                            <field name="populate_date" optional='show'/>
                            <!-- <field name="account_id" optional='hide' options="{'no_create': True, 'no_quick_create': True}" string="Account" column_invisible="1"/> -->
                            <field name="invoice_id" string="No. TRX" options="{'no_create': True, 'no_quick_create': True}" optional="show"/>  
                            <field name="nomor_invoice" string="No. Invoice" optional='show' readonly="1" />
                            <field name="no_sep_ref_no" optional='show' string="No. SEP "/>
                            <field name="med_rec_number" optional='show' string="Med. Rec Number"/>
                            <field name="amount_total_signed" optional='show' readonly="1" string="Invoice Amount" />
                            <field name="partner_id" optional='hide' string="Penjamin"/>
                            <!-- <field name="invoice_amount" string="Invoice Amount" optional='show' sum="Total Invoice"/> -->
                            <field name="invoice_amount_claim" string="Claim Amount" optional='show' sum="Total Klaim"/>
                            <field name="amount_diff" string="Selisih" optional='show'/>
                            <field name="status_invoice" string="Invoice Status" widget="badge" optional='show' decoration-success="status_invoice == 'Closed'" decoration-danger="status_invoice != 'Closed'" on_change="1" field_id="status_invoice_0"/>
                            <field name="paid_state_klaim"/>
                            <button name="ar_klaim_invoice_detail_button" type="object" string="Detail" class="fa fa-eye" />
                        </tree>
                    </field>
                    <group col="12" class="oe_invoice_lines_tab" name="klaim_line_tab">
                        <group colspan="8">
                            <field name="narration" placeholder="Terms and Conditions" colspan="2" nolabel="1"/>
                        </group>
                        <group class="oe_klaim_subtotal_footer" colspan="4">
                            <field name="total_invoice" string="Total Amount" placeholder="Total Amount Invoice" colspan="2" readonly="state !='draft'" style="font-weight: bold;" />
                            <field name="amount_total_signed" string="Total Amount Claim" placeholder="Total Amount Claim" colspan="2" readonly="state !='draft'" style="font-weight: bold;" />
                        </group>
                    </group>
                </page>
            </xpath>
            <xpath expr="//page[@name='aml_tab']" position="after">
                <page id="journal_klaim_tab" name="journal_klaim_tab" string="Journal Klaim" invisible="not is_klaim">
                    <field name="line_ids" context="{'default_move_type': context.get('default_move_type'), 'line_ids': line_ids, 'journal_id': journal_id, 'default_currency_id': currency_id or company_currency_id,}" invisible="payment_state == 'invoicing_legacy' and move_type != 'entry'" readonly="state != 'draft'" on_change="1" field_id="line_ids_1"> 
                        <tree editable="bottom" create="1" string="Journal Klaim" group_by="entered_date" default_order="sequence, id">
                            <field name="create_date" optional="show" string="Create Date" column_invisible="1"/>
                            <field name="populate_date" optional='show'/>
                            <field name="flag" optional='show'/>
                            <field name="account_id" optional='show' string="Account" readonly="1" />
                            <field name="name" string="Label" optional='show'/>
                            <field name="company_id" column_invisible="1"/>
                            <field name="currency_id" column_invisible="1"/>
                            <field name="debit" string="Debit" optional='show' sum="Total Debit"/>
                            <field name="credit" string="Credit" optional='show' sum="Total Credit"/>
                        </tree>
                    </field>
                    <group col="12" class="oe_invoice_lines_tab" name="klaim_journal_line_tab">
                        <group colspan="8">
                        </group>
                        <group class="oe_klaim_subtotal_footer" colspan="4">
                            <field name="total_debit" placeholder="Total Debit" colspan="2" readonly="1" style="font-weight: bold;" />
                            <field name="total_credit" placeholder="Total Credit" colspan="2" readonly="1" style="font-weight: bold;" />
                        </group>
                    </group>
                </page>
            </xpath>
            <xpath expr="//page[@name='aml_tab']" position="attributes">
                <attribute name="invisible">is_klaim</attribute>
            </xpath>
         
            <xpath expr="//field[@name='invoice_line_ids']/tree" position="attributes">
                <attribute name="create">true</attribute>
                <attribute name="editable">bottom</attribute>
                <attribute name="group_by">entered_date</attribute>
                <!-- <attribute name="decoration-danger">not is_pelayanan</attribute> -->
                <!-- <attribute name="decoration-success"></attribute> -->
            </xpath>


            <!-- <field name="line_ids"
                mode="tree,kanban"
                attrs="{'invisible': [('show_line_ids', '=', False)]}"
                context="{
                    'default_move_type': context.get('default_move_type'),
                    'line_ids': line_ids,
                    'journal_id': journal_id,
                    'default_partner_id': commercial_partner_id,
                    'default_currency_id': currency_id or company_currency_id,
                    'kanban_view_ref': 'account.account_move_line_view_kanban_mobile',
                }"
                readonly="state != 'draft'">
                <tree editable="bottom" string="Journal Items">
                    <field name="account_id" required="1"/>
                    <field name="partner_id" optional="show"/>
                    <field name="name" widget="section_and_note_text" optional="show"/>
                    <field name="debit" sum="Total Debit"/>
                    <field name="credit" sum="Total Credit"/>
                </tree>
            </field> -->
        </field>
    </record>

    <record id="view_journal_items_tree_inherit" model="ir.ui.view">
            <field name="name">account.view_move_line_tree</field>
            <field name="model">account.move.line</field>
            <field name="inherit_id" ref="account.view_move_line_tree"/>
            <field name="arch" type="xml">
                <xpath expr="//tree/field[@name='date']" position="before">
                    <field name="accounting_periode_id" string="Accounting Period" optional="show" options="{'no_create': True,'no_create_edit': True}"/>
                    <field name="populate_date" optional="hide"/>
                    <field name="entered_date" optional="show"/>
                    <field name="no_trx" optional="hide"/>
                    <field name="flag" optional="hide"/>
                    <field name="concat_field" optional="hide" string="Nomor Transaksi"/>
                </xpath>
                <xpath expr="//tree/field[@name='date']" position="replace">
                    <field name="date" optional="show"/>
                </xpath>
                <xpath expr="//tree/field[@name='account_id']" position="replace">
                    <field name="account_id" optional="show"/>
                </xpath>
                <xpath expr="//tree/field[@name='move_name']" position="replace">
                    <field name="move_name" optional="show"/>
                </xpath>
                <!-- <xpath expr="//tree/field[@name='date']" position="after">
                    <field name="patient_name" string="Nama Pasien"/>
                    <field name="med_rec_number" string="Nomor Medis"/>
                    <field name="penjamin_name_id" string="Nama Penjamin"/>
                </xpath> -->
            </field>
        </record>

    <record id="inherit_account_move_line_search" model="ir.ui.view">
        <field name="name">account.move.line.search.inherit</field>
        <field name="model">account.move.line</field>
        <field name="inherit_id" ref="account.view_account_move_line_filter"/>
        <field name="arch" type="xml">
            <xpath expr="//search" position="inside">
                <field name="no_trx" string="No Transaction"/>
            </xpath>
        </field>
    </record>

</odoo>
